(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.MultiformatsMultiaddrMatcher = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var MultiformatsMultiaddrMatcher=(()=>{var L=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var Ae=Object.prototype.hasOwnProperty;var ve=(t,e)=>{for(var r in e)L(t,r,{get:e[r],enumerable:!0})},Ie=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of ge(e))!Ae.call(t,o)&&o!==r&&L(t,o,{get:()=>e[o],enumerable:!(n=ye(e,o))||n.enumerable});return t};var Pe=t=>Ie(L({},"__esModule",{value:!0}),t);var at={};ve(at,{Circuit:()=>Ke,DNS:()=>Re,DNS4:()=>We,DNS6:()=>ke,DNSADDR:()=>Me,HTTP:()=>rt,HTTPS:()=>ot,IP:()=>Be,IP4:()=>Ve,IP6:()=>Oe,IP_OR_DOMAIN:()=>ze,Memory:()=>st,P2P:()=>Je,QUIC:()=>Xe,QUICV1:()=>Le,TCP:()=>Ge,UDP:()=>$e,WebRTC:()=>et,WebRTCDirect:()=>je,WebSockets:()=>qe,WebSocketsSecure:()=>He,WebTransport:()=>Fe});var V=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let r=this.index,n=e();return n===void 0&&(this.index=r),n}parseWith(e){let r=e();if(this.index===this.input.length)return r}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let r=this.readChar();if(r===e)return r})}readSeparator(e,r,n){return this.readAtomically(()=>{if(!(r>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,r,n,o){return this.readAtomically(()=>{let i=0,d=0,u=this.peekChar();if(u===void 0)return;let m=u==="0",D=2**(8*o)-1;for(;;){let b=this.readAtomically(()=>{let S=this.readChar();if(S===void 0)return;let T=Number.parseInt(S,e);if(!Number.isNaN(T))return T});if(b===void 0)break;if(i*=e,i+=b,i>D||(d+=1,r!==void 0&&d>r))return}if(d!==0)return!n&&m&&d>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let r=0;r<e.length;r++){let n=this.readSeparator(".",r,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[r]=n}return e})}readIPv6Addr(){let e=r=>{for(let n=0;n<r.length/2;n++){let o=n*2;if(n<r.length-3){let d=this.readSeparator(":",n,()=>this.readIPv4Addr());if(d!==void 0)return r[o]=d[0],r[o+1]=d[1],r[o+2]=d[2],r[o+3]=d[3],[o+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[o,!1];r[o]=i>>8,r[o+1]=i&255}return[r.length,!1]};return this.readAtomically(()=>{let r=new Uint8Array(16),[n,o]=e(r);if(n===16)return r;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),d=16-(n+2),[u]=e(i.subarray(0,d));return r.set(i.subarray(0,u),16-u),r})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var Ue=45,_e=15,O=new V;function re(t){if(!(t.length>_e))return O.new(t).parseWith(()=>O.readIPv4Addr())}function ne(t){if(t.includes("%")&&(t=t.split("%")[0]),!(t.length>Ue))return O.new(t).parseWith(()=>O.readIPv6Addr())}function oe(t){return!!re(t)}function ie(t){return!!ne(t)}var xt=new Uint8Array(0);function se(t){if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")}function Se(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<t.length;o++){var i=t.charAt(o),d=i.charCodeAt(0);if(r[d]!==255)throw new TypeError(i+" is ambiguous");r[d]=o}var u=t.length,m=t.charAt(0),D=Math.log(u)/Math.log(256),b=Math.log(256)/Math.log(u);function S(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";for(var x=0,C=0,y=0,A=h.length;y!==A&&h[y]===0;)y++,x++;for(var v=(A-y)*b+1>>>0,w=new Uint8Array(v);y!==A;){for(var I=h[y],_=0,g=v-1;(I!==0||_<C)&&g!==-1;g--,_++)I+=256*w[g]>>>0,w[g]=I%u>>>0,I=I/u>>>0;if(I!==0)throw new Error("Non-zero carry");C=_,y++}for(var P=v-C;P!==v&&w[P]===0;)P++;for(var z=m.repeat(x);P<v;++P)z+=t.charAt(w[P]);return z}function T(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;var x=0;if(h[x]!==" "){for(var C=0,y=0;h[x]===m;)C++,x++;for(var A=(h.length-x)*D+1>>>0,v=new Uint8Array(A);h[x];){var w=r[h.charCodeAt(x)];if(w===255)return;for(var I=0,_=A-1;(w!==0||I<y)&&_!==-1;_--,I++)w+=u*v[_]>>>0,v[_]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");y=I,x++}if(h[x]!==" "){for(var g=A-y;g!==A&&v[g]===0;)g++;for(var P=new Uint8Array(C+(A-g)),z=C;g!==A;)P[z++]=v[g++];return P}}}function we(h){var x=T(h);if(x)return x;throw new Error(`Non-${e} character`)}return{encode:S,decodeUnsafe:T,decode:we}}var Ce=Se,Ne=Ce,ae=Ne;var q=class{name;prefix;baseEncode;constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},H=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,r,n){this.name=e,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ce(this,e)}},j=class{decoders;constructor(e){this.decoders=e}or(e){return ce(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function ce(t,e){return new j({...t.decoders??{[t.prefix]:t},...e.decoders??{[e.prefix]:e}})}var F=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,r,n,o){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new q(e,r,n),this.decoder=new H(e,r,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function fe({name:t,prefix:e,encode:r,decode:n}){return new F(t,e,r,n)}function J({name:t,prefix:e,alphabet:r}){let{encode:n,decode:o}=ae(r,t);return fe({prefix:e,name:t,encode:n,decode:i=>se(o(i))})}function Ee(t,e,r,n){let o={};for(let b=0;b<e.length;++b)o[e[b]]=b;let i=t.length;for(;t[i-1]==="=";)--i;let d=new Uint8Array(i*r/8|0),u=0,m=0,D=0;for(let b=0;b<i;++b){let S=o[t[b]];if(S===void 0)throw new SyntaxError(`Non-${n} character`);m=m<<r|S,u+=r,u>=8&&(u-=8,d[D++]=255&m>>u)}if(u>=r||255&m<<8-u)throw new SyntaxError("Unexpected end of data");return d}function De(t,e,r){let n=e[e.length-1]==="=",o=(1<<r)-1,i="",d=0,u=0;for(let m=0;m<t.length;++m)for(u=u<<8|t[m],d+=8;d>r;)d-=r,i+=e[o&u>>d];if(d!==0&&(i+=e[o&u<<r-d]),n)for(;i.length*r&7;)i+="=";return i}function W({name:t,prefix:e,bitsPerChar:r,alphabet:n}){return fe({prefix:e,name:t,encode(o){return De(o,n,r)},decode(o){return Ee(o,n,r,t)}})}var de=J({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),vt=J({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ut=W({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),_t=W({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ue=W({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),St=W({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Te=t=>t.toString().split("/").slice(1),E=t=>({match:e=>e.length<1?!1:t(e[0])?e.slice(1):!1,pattern:"fn"}),s=t=>({match:e=>E(r=>r===t).match(e),pattern:t}),N=()=>({match:t=>E(e=>typeof e=="string").match(t),pattern:"{string}"}),k=()=>({match:t=>E(e=>!isNaN(parseInt(e))).match(t),pattern:"{number}"}),f=()=>({match:t=>{if(t.length<2||t[0]!=="p2p"&&t[0]!=="ipfs")return!1;if(t[1].startsWith("Q")||t[1].startsWith("1"))try{de.decode(`z${t[1]}`)}catch{return!1}else return!1;return t.slice(2)},pattern:"/p2p/{peerid}"}),M=()=>({match:t=>{if(t.length<2||t[0]!=="certhash")return!1;try{ue.decode(t[1])}catch{return!1}return t.slice(2)},pattern:"/certhash/{certhash}"}),c=t=>({match:e=>{let r=t.match(e);return r===!1?e:r},pattern:`optional(${t.pattern})`}),l=(...t)=>({match:e=>{let r;for(let n of t){let o=n.match(e);o!==!1&&(r==null||o.length<r.length)&&(r=o)}return r??!1},pattern:`or(${t.map(e=>e.pattern).join(", ")})`}),a=(...t)=>({match:e=>{for(let r of t){let n=r.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${t.map(e=>e.pattern).join(", ")})`});function p(...t){function e(o){let i=Te(o);for(let d of t){let u=d.match(i);if(u===!1)return!1;i=u}return i}function r(o){return e(o)!==!1}function n(o){let i=e(o);return i===!1?!1:i.length===0}return{matchers:t,matches:r,exactMatch:n}}var G=a(s("dns4"),N()),$=a(s("dns6"),N()),Q=a(s("dnsaddr"),N()),K=a(s("dns"),N()),We=p(G,c(f())),ke=p($,c(f())),Me=p(Q,c(f())),Re=p(l(K,Q,G,$),c(f())),he=a(s("ip4"),E(oe)),pe=a(s("ip6"),E(ie)),Y=l(he,pe),U=l(Y,K,G,$,Q),ze=p(l(Y,a(l(K,Q,G,$),c(f())))),Ve=p(he),Oe=p(pe),Be=p(Y),ee=a(U,s("tcp"),k()),R=a(U,s("udp"),k()),Ge=p(a(ee,c(f()))),$e=p(R),te=a(R,s("quic"),c(f())),X=a(R,s("quic-v1"),c(f())),Qe=l(te,X),Xe=p(te),Le=p(X),Z=l(U,ee,R,te,X),le=l(a(Z,s("ws"),c(f()))),qe=p(le),xe=l(a(Z,s("wss"),c(f())),a(Z,s("tls"),c(a(s("sni"),N())),s("ws"),c(f()))),He=p(xe),me=a(R,s("webrtc-direct"),c(M()),c(M()),c(f())),je=p(me),be=a(X,s("webtransport"),c(M()),c(M()),c(f())),Fe=p(be),B=l(le,xe,a(ee,c(f())),a(Qe,c(f())),a(U,c(f())),me,be,f()),Je=p(B),Ze=a(B,s("p2p-circuit"),f()),Ke=p(Ze),Ye=l(a(B,s("p2p-circuit"),s("webrtc"),c(f())),a(B,s("webrtc"),c(f())),a(s("webrtc"),c(f()))),et=p(Ye),tt=l(a(U,s("tcp"),k(),s("http"),c(f())),a(U,s("http"),c(f()))),rt=p(tt),nt=l(a(U,s("tcp"),l(a(s("443"),s("http")),a(k(),s("https"))),c(f())),a(U,s("tls"),s("http"),c(f())),a(U,s("https"),c(f()))),ot=p(nt),it=l(a(s("memory"),N(),c(f()))),st=p(it);return Pe(at);})();
return MultiformatsMultiaddrMatcher}));
